@model IEnumerable<barApp.Creditos>

@if (ViewData["ListaHistoricoCreditos"] != null)
{
    <table class="table table-bordered dataTable w-100" id="dataTable2" cellspacing="0" role="grid">

        <tr class="odd">
            <th>
                Id
            </th>
            <th>
                Usuario
            </th>
            <th>
                Factura
            </th>
            <th>
                Pagos realizados
            </th>

            <th>Opciones</th>
        </tr>

        @foreach (var item in ViewData["ListaHistoricoCreditos"] as IEnumerable<barApp.Creditos>)
        {
            <tr class="odd">
                <td>
                    @Html.DisplayFor(modelItem => item.id)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Usuario.nombre)
                </td>
                <td>
                    @Html.Raw((int)item.numFactura)
                </td>
                <td>
                    @item.Pagos.Count()
                </td>
                <td>
                    <button class="btn btn-link" onclick="ShowHistoricoCredito(@item.id)"><i class="fas fa-file-invoice-dollar"></i></button>
                </td>
            </tr>
        }
    </table>
}

@*<div class="modal fade" id="ModalHistoricoCredito" tabindex="-1" role="dialog" data-backdrop="true" data-keyboard="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><span class="fa-2x">Histórico de pagos</span></h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered dataTable w-100" cellspacing="0" role="grid"></table>
            </div>
        </div>
    </div>
</div>

<script>
    function ShowHistoricoCredito(id) {
        let modaTable = $('#ModalHistoricoCredito table');
        modaTable.html('<tr class="odd"><th>Fecha de pago</th><th>Monto pagado</th></tr>')

        $(creditos.filter(c => c.id == id)[0].Pagos).each((_, pago) => {
            modaTable.append(`<tr class="odd"><td>${pago.Fecha.split('T')[0]}</td><td>${formatter.format(pago.Monto)}</td></tr>`);
        });

        $('#ModalHistoricoCredito').modal('show');
    }
</script>*@

